<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Devanagari Letter Sounds</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body { font-family: system-ui, Arial, sans-serif; padding: 16px; }
    h1 { font-size: 20px; margin: 0 0 10px; }

    /* Devanagari-capable font stack for buttons */
    .grid, .grid5, .line, button {
      font-family: "Noto Sans Devanagari","Nirmala UI","Mangal",system-ui,sans-serif;
    }

    .grid { display: grid; grid-template-columns: repeat(8, minmax(44px, 1fr)); gap: 10px; max-width: 900px; }
    button {
      font-size: 26px; padding: 10px 0; border-radius: 12px; border: 1px solid #ddd;
      background: white; cursor: pointer; box-shadow: 0 1px 2px rgba(0,0,0,.06);
    }
    button:active { transform: scale(0.98); }

    .row { display:flex; gap:10px; align-items:center; margin: 10px 0 14px; flex-wrap: wrap; }
    label { font-size: 14px; color:#444; }
    .small { font-size: 13px; color:#666; margin-top: 10px; }
    .pill { font-size: 13px; padding: 6px 10px; border-radius: 999px; border: 1px solid #ddd; background:#fafafa; }

    h2 { font-size: 16px; margin: 0; }
    .grid5 { display:grid; grid-template-columns: repeat(5, minmax(44px, 1fr)); gap: 10px; max-width: 520px; }
    .line { display:flex; gap:10px; flex-wrap: wrap; max-width: 900px; }
    .btnLine { padding: 10px 14px; }

    select { padding: 6px 8px; border-radius: 10px; border: 1px solid #ddd; background: white; }
    .btnSmall { font-size: 14px; padding: 8px 12px; border-radius: 999px; }
  </style>
</head>

<body>
  <h1>Click a letter to hear it</h1>

  <div class="row">
    <span class="pill" id="status">Ready</span>

    <label><input type="checkbox" id="showHint" checked> Show transliteration hint</label>

    <label>
      Display:
      <select id="scheme">
        <option value="deva" selected>Devanagari</option>
        <option value="iast">IAST</option>
        <option value="hk">Harvard–Kyoto</option>
      </select>
    </label>

    <label><input type="checkbox" id="quizMode"> Quiz mode</label>
    <button class="btnSmall" id="newQ" type="button">New question</button>
    <span class="pill" id="qPrompt">Quiz off</span>
  </div>

  <h2 style="margin:14px 0 8px;">स्वराः</h2>
  <div class="grid" id="grid-vowels"></div>

  <h2 style="margin:18px 0 8px;">वर्गीय-व्यञ्जनानि</h2>
  <div class="grid5" id="grid-vargiya"></div>

  <h2 style="margin:18px 0 8px;">अवर्गीय-व्यञ्जनानि</h2>
  <div class="line" id="line-avargiya"></div>

  <p class="small">
    Note: This page must be served from a website (not opened as a local file) for best results.
  </p>

  <script>
    const AUDIO_BASE_URL = "https://laksiyer.github.io/ucchAraNam/audio/";

    // --- DATA ---
    // Each item has: key, deva, iast, hk, hint, file
    // HK conventions used: ā A, ī I, ū U, ṛ R, ṝ RR, ḷ L, ṅ G, ñ J, ṭ T, ḍ D, ṇ N, ś z, ṣ S, ṃ M, ḥ H
    const vowels = [
      { key:"a",  deva:"अ",  iast:"a",   hk:"a",  hint:"a",   file:"a.mp3" },
      { key:"aa", deva:"आ",  iast:"ā",   hk:"A",  hint:"ā",   file:"aa.mp3" },
      { key:"i",  deva:"इ",  iast:"i",   hk:"i",  hint:"i",   file:"i.mp3" },
      { key:"ii", deva:"ई",  iast:"ī",   hk:"I",  hint:"ī",   file:"ii.mp3" },
      { key:"u",  deva:"उ",  iast:"u",   hk:"u",  hint:"u",   file:"u.mp3" },
      { key:"uu", deva:"ऊ",  iast:"ū",   hk:"U",  hint:"ū",   file:"uu.mp3" },
      { key:"ri", deva:"ऋ",  iast:"ṛ",   hk:"R",  hint:"ṛ",   file:"ri.mp3" },
      { key:"rri",deva:"ॠ",  iast:"ṝ",   hk:"RR", hint:"ṝ",   file:"rri.mp3" },
      { key:"lr", deva:"ऌ",  iast:"ḷ",   hk:"L",  hint:"ḷ",   file:"lr.mp3" },
      { key:"e",  deva:"ए",  iast:"e",   hk:"e",  hint:"e",   file:"e.mp3" },
      { key:"ai", deva:"ऐ",  iast:"ai",  hk:"ai", hint:"ai",  file:"ai.mp3" },
      { key:"o",  deva:"ओ",  iast:"o",   hk:"o",  hint:"o",   file:"o.mp3" },
      { key:"au", deva:"औ",  iast:"au",  hk:"au", hint:"au",  file:"au.mp3" },
      { key:"am", deva:"अं", iast:"aṃ",  hk:"aM", hint:"aṃ",  file:"am.mp3" },
      { key:"ah", deva:"अः", iast:"aḥ",  hk:"aH", hint:"aḥ",  file:"ah.mp3" }
    ];

    const vargiya = [
      { key:"ka",  deva:"क", iast:"ka",  hk:"ka",  hint:"ka",  file:"ka.mp3" },
      { key:"kha", deva:"ख", iast:"kha", hk:"kha", hint:"kha", file:"kha.mp3" },
      { key:"ga",  deva:"ग", iast:"ga",  hk:"ga",  hint:"ga",  file:"ga.mp3" },
      { key:"gha", deva:"घ", iast:"gha", hk:"gha", hint:"gha", file:"gha.mp3" },
      { key:"nga", deva:"ङ", iast:"ṅa",  hk:"Ga",  hint:"ṅa",  file:"nga.mp3" },

      { key:"ca",  deva:"च", iast:"ca",  hk:"ca",  hint:"ca",  file:"ca.mp3" },
      { key:"cha", deva:"छ", iast:"cha", hk:"cha", hint:"cha", file:"cha.mp3" },
      { key:"ja",  deva:"ज", iast:"ja",  hk:"ja",  hint:"ja",  file:"ja.mp3" },
      { key:"jha", deva:"झ", iast:"jha", hk:"jha", hint:"jha", file:"jha.mp3" },
      { key:"nya", deva:"ञ", iast:"ña",  hk:"Ja",  hint:"ña",  file:"nya.mp3" },

      { key:"tta",  deva:"ट", iast:"ṭa",  hk:"Ta",  hint:"ṭa",  file:"ta_retro.mp3" },
      { key:"ttha", deva:"ठ", iast:"ṭha", hk:"Tha", hint:"ṭha", file:"tha_retro.mp3" },
      { key:"dda",  deva:"ड", iast:"ḍa",  hk:"Da",  hint:"ḍa",  file:"da_retro.mp3" },
      { key:"ddha", deva:"ढ", iast:"ḍha", hk:"Dha", hint:"ḍha", file:"dha_retro.mp3" },
      { key:"nna",  deva:"ण", iast:"ṇa",  hk:"Na",  hint:"ṇa",  file:"na_retro.mp3" },

      { key:"ta",  deva:"त", iast:"ta",  hk:"ta",  hint:"ta",  file:"ta.mp3" },
      { key:"tha", deva:"थ", iast:"tha", hk:"tha", hint:"tha", file:"tha.mp3" },
      { key:"da",  deva:"द", iast:"da",  hk:"da",  hint:"da",  file:"da.mp3" },
      { key:"dha", deva:"ध", iast:"dha", hk:"dha", hint:"dha", file:"dha.mp3" },
      { key:"na",  deva:"न", iast:"na",  hk:"na",  hint:"na",  file:"na.mp3" },

      { key:"pa",  deva:"प", iast:"pa",  hk:"pa",  hint:"pa",  file:"pa.mp3" },
      { key:"pha", deva:"फ", iast:"pha", hk:"pha", hint:"pha", file:"pha.mp3" },
      { key:"ba",  deva:"ब", iast:"ba",  hk:"ba",  hint:"ba",  file:"ba.mp3" },
      { key:"bha", deva:"भ", iast:"bha", hk:"bha", hint:"bha", file:"bha.mp3" },
      { key:"ma",  deva:"म", iast:"ma",  hk:"ma",  hint:"ma",  file:"ma.mp3" }
    ];

    const avargiya = [
      { key:"ya", deva:"य", iast:"ya", hk:"ya", hint:"ya", file:"ya.mp3" },
      { key:"ra", deva:"र", iast:"ra", hk:"ra", hint:"ra", file:"ra.mp3" },
      { key:"la", deva:"ल", iast:"la", hk:"la", hint:"la", file:"la.mp3" },
      { key:"va", deva:"व", iast:"va", hk:"va", hint:"va", file:"va.mp3" },
      { key:"sha",deva:"श", iast:"śa", hk:"za", hint:"śa", file:"sha_palatal.mp3" },
      { key:"ssa",deva:"ष", iast:"ṣa", hk:"Sa", hint:"ṣa", file:"sha_retro.mp3" },
      { key:"sa", deva:"स", iast:"sa", hk:"sa", hint:"sa", file:"sa.mp3" },
      { key:"ha", deva:"ह", iast:"ha", hk:"ha", hint:"ha", file:"ha.mp3" }
    ];

    // --- PLAYER ---
    const status = document.getElementById("status");
    const showHint = document.getElementById("showHint");
    const player = new Audio();
    player.preload = "auto";

    function setStatus(msg) { status.textContent = msg; }

    function playFile(file, labelForStatus) {
      try { player.pause(); player.currentTime = 0; } catch(e) {}
      const url = AUDIO_BASE_URL + file;
      setStatus("Loading: " + labelForStatus);
      player.src = url;
      player.play()
        .then(() => setStatus("Playing: " + labelForStatus))
        .catch(err => {
          console.error(err);
          setStatus("Audio failed. Check URL / permissions.");
          alert("Could not play audio.\n\nTried: " + url);
        });
    }

    // --- DISPLAY SCHEME ---
    const schemeSel = document.getElementById("scheme");
    let scheme = schemeSel.value; // deva | iast | hk

    function labelOf(x) {
      return (x && x[scheme]) ? x[scheme] : (x.deva || "");
    }

    // --- QUIZ MODE ---
    const quizMode = document.getElementById("quizMode");
    const newQ = document.getElementById("newQ");
    const qPrompt = document.getElementById("qPrompt");

    // Choose quiz pool here:
    // const quizPool = [...vowels, ...vargiya, ...avargiya];
    const quizPool = [...vargiya, ...avargiya]; // consonants only (edit if you want)

    const allItems = [...vowels, ...vargiya, ...avargiya];
    const allItemsByKey = new Map(allItems.map(x => [x.key, x]));

    let quizAnswerKey = null;

    function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

    function startQuestion() {
      const x = pick(quizPool);
      quizAnswerKey = x.key;
      qPrompt.textContent = "Listen → click the correct letter";
      playFile(x.file, "Quiz sound");
    }

    newQ.addEventListener("click", () => {
      if (quizMode.checked) startQuestion();
    });

    quizMode.addEventListener("change", () => {
      if (quizMode.checked) {
        qPrompt.textContent = "Quiz on";
        startQuestion();
      } else {
        quizAnswerKey = null;
        qPrompt.textContent = "Quiz off";
      }
    });

    // --- RENDERING ---
    function renderButtons(containerId, items, mode) {
      const container = document.getElementById(containerId);
      items.forEach(x => {
        const b = document.createElement("button");
        b.textContent = labelOf(x);
        b.className = (mode === "line") ? "btnLine" : "";

        // stable lookup for re-labeling on scheme switch
        b.setAttribute("data-key", x.key);

        const updateTitle = () => {
          b.title = showHint.checked ? (x.hint + " (" + x.file + ")") : "";
        };
        updateTitle();
        showHint.addEventListener("change", updateTitle);

        b.onclick = () => {
          if (!quizMode.checked) {
            playFile(x.file, labelOf(x) + (showHint.checked ? " = " + x.hint : ""));
            return;
          }

          // quiz mode: check answer
          if (x.key === quizAnswerKey) {
            qPrompt.textContent = "✅ Correct!";
            // optional: replay the correct sound
            playFile(x.file, "Correct");
            setTimeout(startQuestion, 700);
          } else {
            qPrompt.textContent = "❌ Try again";
            // optional: replay target sound
            // const target = allItemsByKey.get(quizAnswerKey);
            // if (target) playFile(target.file, "Try again");
          }
        };

        container.appendChild(b);
      });
    }

    function refreshButtonLabels() {
      document.querySelectorAll("button[data-key]").forEach(btn => {
        const key = btn.getAttribute("data-key");
        const x = allItemsByKey.get(key);
        btn.textContent = labelOf(x);
      });
    }

    schemeSel.addEventListener("change", () => {
      scheme = schemeSel.value;
      refreshButtonLabels();
    });

    renderButtons("grid-vowels", vowels);
    renderButtons("grid-vargiya", vargiya);
    renderButtons("line-avargiya", avargiya, "line");
  </script>
</body>
</html>
