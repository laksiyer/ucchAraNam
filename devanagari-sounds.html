<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Devanagari Pronunciation Tool</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body { font-family: system-ui, Arial, sans-serif; padding: 16px; }
    h1 { font-size: 20px; margin-bottom: 8px; }
    h2 { font-size: 16px; margin: 14px 0 8px; }

    .row { display:flex; gap:10px; align-items:center; flex-wrap: wrap; margin: 10px 0; }
    .pill { font-size: 13px; padding: 6px 10px; border-radius: 999px; border: 1px solid #ddd; background:#fafafa; }
    .small { font-size: 13px; color:#666; }

    .grid { display: grid; grid-template-columns: repeat(8, minmax(54px, 1fr)); gap: 10px; }
    .grid5 { display:grid; grid-template-columns: repeat(5, minmax(54px, 1fr)); gap: 10px; max-width: 520px; }
    .line { display:flex; gap:10px; flex-wrap: wrap; }

    .letterBtn{
      font-family: "Noto Sans Devanagari","Mangal","Nirmala UI",sans-serif;
      font-size: 26px;
      padding: 10px 0;
      border-radius: 12px;
      border: 1px solid #ddd;
      background: white;
      cursor: pointer;
    }

    /* Gunita color coding */
    #gunita-consonants .letterBtn { background:#fff; }
    #gunita-matras .letterBtn { background:#e7f1ff; border-color:#2b6cb0; }
    #gunita-matras .letterBtn[data-matra="a"] { background:#f3f4f6; }

    #gunita-display {
      font-family: "Noto Sans Devanagari","Mangal","Nirmala UI",sans-serif;
      font-size: 64px;
      padding: 16px 28px;
      border-radius: 18px;
      background: #fff7e6;
      border: 2px solid #b45309;
      min-width: 160px;
      text-align: center;
      position: relative;
    }
    #gunita-display::before {
      content:"";
      position:absolute;
      left:0; top:0;
      width:10px; height:100%;
      background:#b45309;
      border-top-left-radius:18px;
      border-bottom-left-radius:18px;
    }
  </style>
</head>

<body>
<h1>Devanagari Pronunciation Tool</h1>

<h2>गुणित अक्षराणि <span class="small">(Work in progress)</span></h2>

<div class="row">
  <span class="pill">1) Click consonant → 2) Click vowel sign</span>
  <span class="pill" id="gunita-status">Selected: —</span>
</div>

<div class="line" id="gunita-consonants"></div>
<div class="line" id="gunita-matras"></div>

<div class="row">
  <div id="gunita-display">—</div>
</div>

<p class="small">Developed by Samskritabharati USA</p>

<script>
const AUDIO_BASE_URL = "https://laksiyer.github.io/ucchAraNam/audio/";
const player = new Audio();

const consonants = [
  { key:"ka", deva:"क", file:"ka.mp3" },
  { key:"kha", deva:"ख", file:"kha.mp3" },
  { key:"ga", deva:"ग", file:"ga.mp3" },
  { key:"gha", deva:"घ", file:"gha.mp3" },
  { key:"ca", deva:"च", file:"ca.mp3" },
  { key:"ja", deva:"ज", file:"ja.mp3" },
  { key:"ta", deva:"त", file:"ta.mp3" },
  { key:"pa", deva:"प", file:"pa.mp3" },
  { key:"ma", deva:"म", file:"ma.mp3" }
];

const matras = [
  { key:"a",  deva:"",  vowelFile:"a.mp3" },
  { key:"aa", deva:"ा", vowelFile:"aa.mp3" },
  { key:"i",  deva:"ि", vowelFile:"i.mp3" },
  { key:"ii", deva:"ी", vowelFile:"ii.mp3" },
  { key:"u",  deva:"ु", vowelFile:"u.mp3" },
  { key:"uu", deva:"ू", vowelFile:"uu.mp3" },
  { key:"e",  deva:"े", vowelFile:"e.mp3" },
  { key:"ai", deva:"ै", vowelFile:"ai.mp3" },
  { key:"o",  deva:"ो", vowelFile:"o.mp3" },
  { key:"au", deva:"ौ", vowelFile:"au.mp3" },
  { key:"am", deva:"ं", vowelFile:"am.mp3" },
  { key:"ah", deva:"ः", vowelFile:"ah.mp3" }
];

const gunitaStatus = document.getElementById("gunita-status");
const gunitaDisplay = document.getElementById("gunita-display");

let selectedConsonant = null;

async function playFile(file) {
  player.src = AUDIO_BASE_URL + file;
  await player.play();
}

async function tryPlaySingle(file) {
  return new Promise((resolve, reject) => {
    player.src = AUDIO_BASE_URL + file;
    player.onended = resolve;
    player.onerror = reject;
    player.play().catch(reject);
  });
}

async function playGunita(consonant, matra) {
  const gunitaFile = `${consonant.key}_${matra.key}.mp3`;

  // 1) vowel sound
  await playFile(matra.vowelFile);

  // 2) combined syllable
  try {
    await tryPlaySingle(gunitaFile);
  } catch {
    await playFile(consonant.file);
    await playFile(matra.vowelFile);
  }
}

const cDiv = document.getElementById("gunita-consonants");
const mDiv = document.getElementById("gunita-matras");

consonants.forEach(c => {
  const b = document.createElement("button");
  b.className = "letterBtn";
  b.textContent = c.deva;
  b.onclick = async () => {
    selectedConsonant = c;
    gunitaStatus.textContent = "Selected: " + c.deva;
    gunitaDisplay.textContent = c.deva;
    await playFile(c.file);
  };
  cDiv.appendChild(b);
});

matras.forEach(m => {
  const b = document.createElement("button");
  b.className = "letterBtn";
  b.dataset.matra = m.key;
  b.textContent = m.deva || "अ";
  b.onclick = async () => {
    if (!selectedConsonant) return alert("Select a consonant first");
    const combined = selectedConsonant.deva + (m.deva || "");
    gunitaDisplay.textContent = combined;
    await playGunita(selectedConsonant, m);
  };
  mDiv.appendChild(b);
});
</script>
</body>
</html>
